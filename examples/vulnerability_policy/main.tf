terraform {
  required_providers {
    dome9 = {
      source = "dome9/dome9"
    }
  }
}

variable "dome9_api_access_id" {
  type = string
}

variable "dome9_api_secret" {
  type = string
}

variable "target_id" {
  type = string
}

# Configure the Dome9 Provider, works with US region by default
provider "dome9" {
  dome9_access_id  = var.dome9_api_access_id
  dome9_secret_key = var.dome9_api_secret
}

resource "dome9_vulnerability_policy" "vulnerability_policy_test" {
  target_id  = var.target_id
  ruleset_id = -2007
  // options: ["Environment", "OrganizationalUnit"]
  target_type                        = "Environment"
  notification_ids                   = ["00000000-0000-0000-0000-000000000000"]
  admission_control_action           = "Detection"
  admission_control_unscanned_action = "Detection"
}

data "dome9_vulnerability_policy" "vulnerability_policy_test" {
  id = dome9_vulnerability_policy.vulnerability_policy_test.id
}

output "getPolicyId" {
  value = dome9_vulnerability_policy.vulnerability_policy_test.id
}

output "getTargetId" {
  value = dome9_vulnerability_policy.vulnerability_policy_test.target_id
}

output "getAdmissionControlAction" {
  value = dome9_vulnerability_policy.vulnerability_policy_test.admission_control_action
}

output "getAdmissionControlUnScannedAction" {
  value = dome9_vulnerability_policy.vulnerability_policy_test.admission_control_unscanned_action
}
